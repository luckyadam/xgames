"use strict";PP.define("games/page/shakeit",function(t,i,e){var n=t("gb/widget/login"),s=t("gb/widget/lottery"),a=t("toast"),o=_.Class.extend({construct:function(t){this.conf=$.extend({$el:null},t),s.init({actId:this.conf.actId},$.proxy(function(t){if(t&&void 0!==t.code){var i=t.data;switch(t.code){case"000":case"001":new a("活动已经结束!");break;case"111":case"112":0===i.coin?new a("积分不足，请分享！"):1===i.coin&&new a("抽奖次数已用完!");break;case"201":case"211":if(!i)return void new a("网络错误，请刷新重试");var e=parseInt(i.coin,10),s=!1;if(isNaN(e))return void new a("网络错误，请刷新重试");if(e>0){var o=Math.floor(e/this.conf.lotSingleCost);o>0?(s=!0,this.init(),this.initEvent(),_.eventCenter.trigger("shake_game_init",{token:t.token,actId:this.conf.actId})):(s=!1,new a("次数用完"))}else s=!1;!s&&i.limit&&(isNaN(i.limit.share_dateMax)||isNaN(i.limit.share_date)||new a(i.limit.share_dateMax-i.limit.share_date>0?"分享增加次数":"明天来玩"));break;case"777":new a("请登录"),n.gotoLogin();break;default:new a("网络错误，请刷新重试!!")}}else new a("网络错误，请刷新重试!!")},this))},init:function(){var t=this.conf.$el,i=document.documentElement,e=i.clientWidth,n=e>640?640:e,s=i.clientHeight;t.width(n),t.height(s)},initEvent:function(){$(window).on("orientationchange",$.proxy(this.onOrientationchange,this)).on("deviceorientation",$.proxy(this.onDeviceorientation,this))},onOrientationchange:function(){},onDeviceorientation:function(t){t.alpha<=25||t.alpha>=295?_.eventCenter.trigger("games_page_shakeit:forward"):t.alpha>=115&&t.alpha<=235&&_.eventCenter.trigger("games_page_shakeit:invert")}});e.exports=o}),PP.define("games/widget/shakeit_guide",function(t,i,e){var n=_.Class.extend({construct:function(t){this.conf=$.extend({$el:null},t),this.init()},init:function(){this.initEvent(),this.listenEvent(),this.isOnInvert=!1},initEvent:function(){this.conf.$el.on("webkitAnimationEnd",$.proxy(this.onAnimationEnd,this))},listenEvent:function(){_.eventCenter.on("games_page_shakeit:invert",$.proxy(this.onInvert,this))},onInvert:function(){this.isOnInvert||this.conf.$el.addClass("dismiss")},onAnimationEnd:function(){var t=this.conf.$el;t.css("opacity")-0===0&&(t.hide(),_.eventCenter.trigger("games_widget_shakeit_guide:start"))}});e.exports=n}),PP.define("games/widget/shakeit_main",function(t,i,e){var n=t("gb/widget/audio_player"),s=t("toast"),a=t("gb/widget/lottery"),o=t("gb/widget/lottery_dialog"),r=_.Class.extend({construct:function(t){this.conf=$.extend({$el:null},t),_.eventCenter.on("shake_game_init",$.proxy(this.init,this))},init:function(t){this.listenEvent(),this.initEvent(),this.isFirstShake=!0,this.isShaking=!1,this.isEnd=!1,this.$falls=this.conf.$el.find(".sm_ribbons").children(),this.token=t.token,this.actId=t.actId,this.lotteryDialog=new o,this.bgPlayer=new n({src:"/xgames/games/images/shake_bg_4462b638.wav",autoplay:!1,loop:!1,type:"audio/wav"})},initEvent:function(){$(window).on("shake",$.proxy(this.shakeEventDidOccur,this)).on("unshake",$.proxy(this.unShakeEventDidOccur,this))},listenEvent:function(){_.eventCenter.on("games_widget_shakeit_guide:start",$.proxy(this.onReady,this)),_.eventCenter.on("gb_widget_countdown2:timeisup",$.proxy(this.onStart,this)),_.eventCenter.on("gb_widget_countdown:timeisup",$.proxy(this.onTimeisup,this)),_.eventCenter.on("gb_widget_countdown:start",$.proxy(this.onCountdownStart,this)),_.eventCenter.on("gb_widget_countdown:timedown",$.proxy(function(t){t=parseInt(t,10),t===this.randomTime&&this.isShaking&&this.fallLittleP(),1===t&&a.play({token:this.token,actId:this.actId},$.proxy(function(t){if(this.isWinner="unknow",t){var i=t.data;switch(this.gift={},this.isEnd&&_.eventCenter.trigger("gb_widget_countdown:timeisup"),t.code){case"000":case"001":break;case"111":case"112":if(this.isWinner="limit",i.limit){var e=0;isNaN(i.limit.share_dateMax)||isNaN(i.limit.share_date)||(e=i.limit.share_dateMax-i.limit.share_date,new s(e>0?{content:"请分享后刷新页面再试",duration:5e3}:{content:"今日次数已经用完，请明日再来！",duration:5e3}))}break;case"399":this.isWinner=!1;break;case"300":i&&i.sysGift&&1===i.sysGift.giftType?this.isWinner="unknow":i&&i.sysGift&&2===i.sysGift.giftType?i.sysGift.giftValue&&i.sysGift.giftName?(this.gift.value=i.sysGift.giftValue,this.gift.name=i.sysGift.giftName,this.gift.url=i.sysGift.coupon,this.isWinner=!0):new s("网络错误，请刷新重试"):this.isWinner=!1}}},this))},this))},onReady:function(){$("body").css({transform:"rotate(-180deg)","-webkit-transform":"rotate(-180deg)"}),this.conf.$el.show(),this.randomTime=Math.floor(8*Math.random()+3),setTimeout(function(){_.eventCenter.trigger("gb_widget_countdown2:start")},500)},onStart:function(){setTimeout($.proxy(function(){this.shakeEvent=new Shake({threshold:8,timeout:500}),this.shakeEvent.start()},this),600)},onCountdownStart:function(){this.conf.$el.addClass("shake_notice")},shakeEventDidOccur:function(t){this.bgPlayer.play(),this.isShaking||this.isFirstShake||_.eventCenter.trigger("gb_widget_countdown:start"),this.isFirstShake&&(this.conf.$el.removeClass("shake_ini").addClass("shake_ing"),_.eventCenter.trigger("gb_widget_countdown:start"),this.conf.$el.find(".countdown2").hide(),this.isFirstShake=!1),this.falling(),this.isShaking=!0,this.conf.$el.removeClass("shake_notice")},unShakeEventDidOccur:function(){this.bgPlayer.stop(),this.isEnd||(this.conf.$el.addClass("shake_notice"),this.unfalling(),this.isShaking=!1)},fallLittleP:function(){this.conf.$el.addClass("shake_drop").find(".sm_drop").addClass("falling"),this.littlePDropped()},littlePDropped:function(){var t=new n({src:"/xgames/games/images/shake_little_p_ec45cc76.mp3",autoplay:!1,loop:!1});t.play()},falling:function(){this.$falls.addClass("falling")},unfalling:function(){this.$falls.removeClass("falling")},onTimeisup:function(){var t=new n({autoplay:!1,loop:!1});if(this.isEnd=!0,void 0!==this.isWinner){if(this.shakeEvent.stop(),$(window).off("shake unshake"),"limit"===this.isWinner)return;if("unknow"===this.isWinner)return void new s({content:"网络错误，请重新再试！"});this.isWinner?(t.setSrc("/xgames/games/images/shake_win_6f557776.mp3"),t.play(),this.conf.$el.removeClass("shake_drop shake_fart shake_notice").addClass("shake_win").find(".sm_drop").addClass("falling"),setTimeout($.proxy(function(){var i=this.gift;this.lotteryDialog.win(i.value,i.name,i.tip,i.url),t.setSrc("/xgames/games/images/get_gift_cba184d0.mp3"),t.play()},this),1500)):(t.setSrc("/xgames/games/images/shake_fart_83b2670a.mp3"),t.play(),this.conf.$el.removeClass("shake_drop shake_win shake_notice").addClass("shake_fart").find(".sm_drop").addClass("falling"),setTimeout($.proxy(function(){this.lotteryDialog.lose()},this),1500))}else new s({content:"网络错误，请重新再试！"})}});e.exports=r});