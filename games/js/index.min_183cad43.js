"use strict";PP.define("games/page/index",function(t,i,e){Array.prototype.each=function(t,i){var e,n=this.length,s=0,a=function(){++s===n&&i&&i.call(this)};for(e=0;n>e;e++)t.call(this,this[e],e,a)};var n=function(t,i,e){var n=t.length,s=0,a=[],e=e?e:function(){};t.each(function(t,e,r){var o;o=new Image,o.src=t,o.complete?(a[e]=o,s++,i&&i((s/n*100).toString().split(".")[0]),r()):o.onerror=o.onload=function(){a[e]=o,s++,i&&i((s/n*100).toString().split(".")[0]),r()}},e.bind(this,a))},s=["/xgames/games/images/crane_bg_57cda176.png","/xgames/games/images/crane_catch_36719e30.wav","/xgames/games/images/crane_catch_up_b7749698.mp3","/xgames/games/images/crane_drop_cbb07f00.mp3","/xgames/games/images/crane_press_btn_88008cba.mp3","/xgames/games/images/get_gift_cba184d0.mp3","/xgames/games/images/index_bg_db8dbec5.png","/xgames/games/images/little_p_3dca8a3f.png","/xgames/games/images/MFLiHei_Noncommercial-Regular_03bdd4c7.ttf","/xgames/games/images/page_btn_imgs_7bec1422.png","/xgames/games/images/shake_bg_7e689f64.png","/xgames/games/images/shake_bg_4462b638.wav","/xgames/games/images/shake_fart_83b2670a.mp3","/xgames/games/images/shake_little_p_ec45cc76.mp3","/xgames/games/images/shake_win_6f557776.mp3","/xgames/games/images/slot_bg_8ee639a4.png","/xgames/games/images/slot_elements1_ab95bcc9.png","/xgames/games/images/slot_end_e6c674d4.wav","/xgames/games/images/slot_light_off_bc1b486e.png","/xgames/games/images/slot_machine_bg_fed4195a.png","/xgames/games/images/slot_scroll_705b0d83.mp3","/xgames/games/images/slot_tip_bg_08b8329e.png","/xgames/games/images/ss1_c9883634.png","/xgames/games/images/ss2_195fbe65.png","/xgames/games/images/time_over_99d85b03.mp3","/xgames/gb/images/bgm_fd54f6f4.mp3","/xgames/gb/images/countdown_15090e1d.png","/xgames/gb/images/countdown2_6d2a51c1.png","/xgames/gb/images/lh_f74f79cd.ttf","/xgames/gb/images/top_player_f9d76f2e.png","/xgames/gb/images/lottery_dialog_imgs_c12f15ec.png","/xgames/gb/images/popup_yellow_1ec8d671.png"],a=t("gb/widget/loading"),r=t("gb/widget/lottery"),o=t("gb/widget/login"),h=(t("util"),t("toast")),c=_.Class.extend({construct:function(t){this.conf=$.extend({$el:null},t),this.init()},init:function(){this.loading=new a,this.loading.show(),n(s,function(t){console.log(t)},$.proxy(function(){this.checkValidate(!1)},this)),this.connectWebViewJavascriptBridge($.proxy(function(t){t.init(function(t,i){i&&i("0")}),this.setShareBtn()},this)),this.getElements(),this.initEvent(),this.listenEvent()},getElements:function(){this.conf.$el},initEvent:function(){},checkValidate:function(t){r.init({actId:this.conf.actId},$.proxy(function(i){if(this.loading.hide(),this.conf.$el.show().addClass("fadeIn"),i&&void 0!==i.code){var e=i.data;switch(i.code){case"000":case"001":_.eventCenter.trigger("games_index:init",0,0,t),setTimeout(function(){new h("活动已经结束!",5e3)},800);break;case"111":case"112":var n=0;i.data.limit&&(isNaN(i.data.limit.share_dateMax)||isNaN(i.data.limit.share_date)||(n=i.data.limit.share_dateMax-i.data.limit.share_date,new h(n>0?"请分享后刷新页面再试":"今日次数已经用完，请明日再来！"))),_.eventCenter.trigger("games_index:init",0,n,t);break;case"201":case"211":if(!e)return void new h("网络错误，请刷新重试");var s=parseInt(e.coin,10),a=!1;if(isNaN(s))return void new h("网络错误，请刷新重试");var r=Math.floor(s/this.conf.lotSingleCost),n=0;this.conf.$el.find(),a=r>0?!0:!1,!a&&e.limit&&(isNaN(e.limit.share_dateMax)||isNaN(e.limit.share_date)||(n=e.limit.share_dateMax-e.limit.share_date,new h(n>0?"分享增加次数":"今日次数已经用完，请明日再来！"))),_.eventCenter.trigger("games_index:init",r,n,t);break;case"777":_.eventCenter.trigger("games_index:init",0,0,t),setTimeout(function(){new h("请先登录!",5e3)},800),o.gotoLogin();break;default:_.eventCenter.trigger("games_index:init",0,0,t),setTimeout(function(){new h("网络错误，请刷新重试!!",5e3)},800)}}else _.eventCenter.trigger("games_index:init",0,0,t),setTimeout(function(){new h("网络错误，请刷新重试!!",5e3)},800)},this))},listenEvent:function(){_.eventCenter.on("games_index_share:emit",$.proxy(this.doShare,this))},connectWebViewJavascriptBridge:function(t){window.WebViewJavascriptBridge?t(WebViewJavascriptBridge):document.addEventListener("WebViewJavascriptBridgeReady",function(){t(WebViewJavascriptBridge)},!1)},getShareArgs:function(){var t="http://luckyadam.github.io/xgames/games/share.html",i={title:"我在京东拍拍玩游戏，不小心中奖了！来试试？？",msg:"超级大奖天天领，就等你来拿哦",links:{Wechat:t,WechatMoments:t,QQ:t,QZone:t,SinaWeibo:t,ShortMessage:t,Link:t},imgUrl:"http://static.paipaiimg.com/fd/h5/xgames/gb/images/cover.png",panelTitle:"每日抽奖分享",finishToast:"1"};return i},doShare:function(){"WebViewJavascriptBridge"in window&&WebViewJavascriptBridge.callHandler("share",JSON.stringify(this.getShareArgs()),$.proxy(function(t){this.shareCallback(t)},this))},setShareBtn:function(){if("WebViewJavascriptBridge"in window){var t=this;WebViewJavascriptBridge.callHandler("setShareButton",JSON.stringify(t.getShareArgs()),function(i){t.shareCallback.call(t,i)})}},shareCallback:function(t){t&&"shareSuccess"===t.event&&r.share({actId:this.conf.actId},$.proxy(function(t){t&&void 0!==t.code?this.checkValidate(!0):setTimeout(function(){new h("网络错误，请刷新重试!!",5e3)},800)},this))}});e.exports=c}),PP.define("games/widget/index_main",function(t,i,e){var n=_.Class.extend({construct:function(t){this.conf=$.extend({$el:null},t),this.init()},init:function(){this.getElements(),this.listenEvent()},getElements:function(){var t=this.conf.$el;this.$tipMsg=t.find(".main_tip_msg"),this.$cards=t.find(".game_carousel_card"),this.$tipMsg=t.find(".main_tip_msg"),this.$gameBtnMsg=t.find(".game_btn_msg")},listenEvent:function(){_.eventCenter.on("games_index:init",$.proxy(this.setInitState,this))},setInitState:function(t,i,e){this.leftTimes=t,this.leftShareTimes=t,t>0?(e?(this.$tipMsg.html('太棒了！赢得<span class="highlight">'+t+"</span>次机会！").show(),this.$cards.removeClass("sfight")):this.$tipMsg.html('今日还剩<span class="highlight">'+t+"</span>次机会").show(),this.$gameBtnMsg.off("click").text("进入游戏"),_.eventCenter.on("games_widget_game_carousel:change",$.proxy(this.onGameShowChange,this))):(i>0?(this.$cards.addClass("sfight"),this.$gameBtnMsg.text("分享再玩一次").attr("href","javascript:;").off("click").on("click",function(){_.eventCenter.trigger("games_index_share:emit")})):(this.$cards.addClass("tfight"),this.$gameBtnMsg.off("click").hide()),this.$tipMsg.hide())},onGameShowChange:function(t){if(this.leftTimes>0)switch(t){case 0:this.$gameBtnMsg.attr("href","crane.html");break;case 1:this.$gameBtnMsg.attr("href","shakeit.html");break;case 2:this.$gameBtnMsg.attr("href","slot_machine.html")}}});e.exports=n}),PP.define("games/widget/game_carousel",function(t,i,e){var n=_.Class.extend({canSlide:!0,construct:function(t){this.conf=$.extend({wrapper:$("body"),isAuto:!1},t),this.init()},init:function(){var t=this.conf.wrapper;this.wrapperWidth=this.conf.wrapper.width(),this.initial={x:5,y:5,sx:0,sy:0,ex:0,ey:0},this.$before=t.find(".before"),this.$prev=t.find(".prev"),this.$next=t.find(".next"),this.initEvent(),this.conf.isAuto&&this.auto()},initEvent:function(){this.conf.wrapper.on("touchstart",$.proxy(this.onStart,this)).on("touchmove",$.proxy(this.onMove,this)).on("touchend",$.proxy(this.onEnd,this))},classArr:["prev","before","next"],classIdx:1,changeIndex:function(t){this.classIdx;this.classIdx=this.classIdx+t,this.classIdx>2&&(this.classIdx=0),this.classIdx<0&&(this.classIdx=2),_.eventCenter.trigger("games_widget_game_carousel:change",this.classIdx),this.conf.wrapper.removeClass("prev").removeClass("before").removeClass("next").addClass(this.classArr[this.classIdx])},onStart:function(t){var i=this.initial,e=this.conf.wrapper;0===this.wrapperWidth&&(this.wrapperWidth=e.width()),i.sx=t.targetTouches[0].pageX,i.sy=t.targetTouches[0].pageY,i.ex=i.sx,i.ey=i.sy,this.conf.isAuto&&clearInterval(this.autoInterval)},onMove:function(t){if(this.canSlide){this.canSlide=!1;var i=this.initial;i.ex=t.targetTouches[0].pageX,i.ey=t.targetTouches[0].pageY,setTimeout(function(){this.canSlide=!0}.bind(this),200)}},onEnd:function(t){var i=this.initial,e=i.sx-i.ex,n=i.sy-i.ey;Math.abs(n)<Math.abs(e)&&(t.preventDefault(),e>0?this.changeIndex(1):this.changeIndex(-1)),this.conf.isAuto&&(clearInterval(this.autoInterval),this.auto())},auto:function(){this.autoInterval=setInterval($.proxy(function(){this.changeIndex(1)},this),3e3)}});e.exports=n}),PP.define("games/widget/winner_list",function(t,i,e){function n(t){var i=new Date,e=setInterval(function(){var n=new Date-i,s=n/t.duration;s>1&&(s=1);var a=t.delta(s);t.step(a),1==s&&clearInterval(e)},t.delay||10);return e}function s(t){return Math.ceil(t/40*640/750*1e4)/1e4}var a={support3d:"WebKitCSSMatrix"in window&&"m11"in new WebKitCSSMatrix,setTranslateY:function(t){return this.support3d?"translate3d(0, "+t+", 0)":"translate(0, "+t+")"},setTranslateX:function(t){return this.support3d?"translate3d("+t+", 0, 0)":"translate("+t+", 0)"}},r=_.Class.extend({construct:function(t){this.conf=$.extend({$el:null},t),this.init()},init:function(){this.$ul=this.conf.$el.find(".winner_list_cont_list"),this.getWinnerList()},getWinnerList:function(t){var i=this;$.ajax({url:"http://static.paipaiimg.com/js/data/ppms.page17474.js",data:{},type:"GET",dataType:"jsonp",timeout:5e3,jsonpCallback:"showPageData17474",success:function(t){if(t&&t.data){var e=t.data;if("function"==typeof e.sort){for(var n="",s=0;s<e.length;s++){var a="<li><div>"+e[s].num+"</div><div>抽中"+e[s].award+"</div></li>";n+=a}for(var s=0;s<e.length;s++){var a="<li><div>"+e[s].num+"</div><div>抽中"+e[s].award+"</div></li>";n+=a}i.$ul.append(n),i.ulHeight=i.$ul.height(),i.autoScroll()}}},error:function(i,e,n){t&&t()}})},autoScroll:function(){var t=this.ulHeight;0===t&&(t=this.ulHeight=this.$ul.height()),n({delay:10,duration:6e3,delta:function(t){return t},step:$.proxy(function(i){this.$ul.css({"-webkit-transform":a.setTranslateY(s(-t*i)+"rem"),transform:a.setTranslateY(s(-t*i)+"rem")}),1===i&&(this.$ul.css({"-webkit-transform":a.setTranslateY(0),transform:a.setTranslateY(0)}),this.autoScroll())},this)})}});e.exports=r});