"use strict";PP.define("games/page/crane",function(e,t,i){var n=e("gb/widget/login"),a=e("gb/widget/lottery"),s=e("toast"),o=_.Class.extend({construct:function(e){this.conf=$.extend({$el:null},e),this.init()},init:function(){var e=this.conf.$el,t=document.documentElement,i=t.clientWidth,n=i>640?640:i,a=t.clientHeight;e.width(n),e.height(a),this.listenEvent(),this.token=null,this.checkValidate(!1)},listenEvent:function(){_.eventCenter.on("games_crane:init",$.proxy(this.onAfterCheck,this))},checkValidate:function(e){a.init({actId:this.conf.actId},$.proxy(function(t){if(t&&void 0!==t.code){var i=t.data;switch(t.code){case"000":case"001":_.eventCenter.trigger("games_crane:init",0,0,e),setTimeout(function(){new s("活动已经结束!",5e3)},800);break;case"111":case"112":var a=0;t.data.limit&&(isNaN(t.data.limit.share_dateMax)||isNaN(t.data.limit.share_date)||(a=t.data.limit.share_dateMax-t.data.limit.share_date,new s(a>0?"请分享后刷新页面再试":"今日次数已经用完，请明日再来！"))),_.eventCenter.trigger("games_crane:init",0,a,e);break;case"201":case"211":if(!i)return void new s("网络错误，请刷新重试");var o=parseInt(i.coin,10),r=!1;if(isNaN(o))return void new s("网络错误，请刷新重试");var d=Math.floor(o/this.conf.lotSingleCost),a=0;this.conf.$el.find(),r=d>0?!0:!1,!r&&i.limit&&(isNaN(i.limit.share_dateMax)||isNaN(i.limit.share_date)||(a=i.limit.share_dateMax-i.limit.share_date,new s(a>0?"分享增加次数":"今日次数已经用完，请明日再来！"))),this.token=t.token,_.eventCenter.trigger("games_crane:init",d,a,e);break;case"777":_.eventCenter.trigger("games_crane:init",0,0,e),setTimeout(function(){new s("请先登录!",5e3)},800),n.gotoLogin();break;default:_.eventCenter.trigger("games_crane:init",0,0,e),setTimeout(function(){new s("网络错误，请刷新重试!!",5e3)},800)}}else _.eventCenter.trigger("games_crane:init",0,0,e),setTimeout(function(){new s("网络错误，请刷新重试!!",5e3)},800)},this))},onAfterCheck:function(e,t,i){e>0&&setTimeout($.proxy(function(){_.eventCenter.trigger("games_crane:start",this.conf.actId,this.token)},this),2500)}});i.exports=o}),PP.define("games/widget/crane_guide",function(e,t,i){var n=_.Class.extend({construct:function(e){this.conf=$.extend({$el:null},e),this.init()},init:function(){this.listenEvent()},listenEvent:function(){_.eventCenter.on("games_crane:start",$.proxy(this.hide,this))},hide:function(){this.conf.$el.addClass("out")}});i.exports=n}),PP.define("games/widget/crane_main",function(e,t,i){var n=e("gb/widget/audio_player"),a=e("toast"),s=e("gb/widget/lottery"),o=e("gb/widget/lottery_dialog"),r=_.Class.extend({construct:function(e){this.conf=$.extend({$el:null},e),this.init()},init:function(){this.getElements(),this.listenEvent(),this.isGrasped=!1,this.lotteryDialog=new o,this.token=null,this.actId=null,this.timer1=null,this.timer2=null,this.timer3=null,this.timer4=null,this.player=new n({autoplay:!1,loop:!1})},getElements:function(){var e=this.conf.$el;this.$pageBtn1=e.find(".page_btn1"),this.$pageBtn2=e.find(".page_btn2"),this.$pageBtn3=e.find(".page_btn3"),this.$pageBtn4=e.find(".page_btn4"),this.$pageBtn5=e.find(".page_btn5"),this.$pageBtn6=e.find(".page_btn6"),this.$countdown2=e.find(".countdown2"),this.$pageHand=e.find(".page_hand"),this.$pageCraned=e.find(".page_craned")},listenEvent:function(){_.eventCenter.on("games_crane:start",$.proxy(this.show,this)),_.eventCenter.on("gb_widget_countdown:timeisup",$.proxy(this.onTimeisup,this)),_.eventCenter.on("gb_widget_countdown2:timeisup",$.proxy(this.onStart,this))},show:function(e,t){this.actId=e,this.token=t,this.conf.$el.addClass("in"),setTimeout(function(){_.eventCenter.trigger("gb_widget_countdown2:start")},500)},onStart:function(){var e=this;this.timer1=setTimeout(function(){_.eventCenter.trigger("gb_widget_countdown:start"),e.$pageBtn1.hide(),e.$countdown2.hide(),e.$pageBtn2.show(),e.$pageBtn3.hide(),e.$pageBtn4.hide(),e.$pageBtn5.hide(),e.$pageBtn6.hide(),e.$pageCraned.removeClass("in"),e.conf.$el.off("tap").on("tap",".page_btn2",function(){$(this).hide(),e.player.setSrc("/xgames/games/images/crane_press_btn_88008cba.mp3"),e.player.play(),e.$pageBtn3.show(),e.$pageHand.addClass("down"),Math.random()>.5?e.$pageCraned.addClass("page_craned2"):e.$pageCraned.removeClass("page_craned2"),setTimeout(function(){e.$pageBtn3.hide(),e.$pageBtn1.show()},200),e.timer2=setTimeout(function(){e.player.setSrc("/xgames/games/images/crane_catch_36719e30.wav","audio/wav"),e.player.play(),setTimeout($.proxy(function(){e.upPlayer=new n({autoplay:!1,loop:!1,src:"/xgames/games/images/crane_catch_up_b7749698.mp3"}),e.upPlayer.play()},this),100),e.$pageCraned.addClass("in"),e.$pageBtn1.hide(),e.$pageBtn4.show(),e.timer3=setTimeout(function(){e.$pageBtn4.hide(),Math.random()>.3?(e.$pageHand.addClass("page_handlose").removeClass("down"),e.$pageCraned.addClass("down"),e.$pageBtn6.show(),e.upPlayer&&e.upPlayer.stop(),e.timer4=setTimeout(function(){e.$pageBtn6.hide(),e.$pageBtn2.show(),e.$pageHand.removeClass("page_handlose"),e.$pageCraned.removeClass("down in")},800)):(e.isGrasped=!0,e.$pageHand.addClass("page_handwin"),e.$pageCraned.removeClass("down").addClass("in"),e.$pageBtn5.show(),e.onTimeisup())},1500)},2500)})},800)},onTimeisup:function(){clearTimeout(this.timer1),clearTimeout(this.timer2),clearTimeout(this.timer3),clearTimeout(this.timer4),this.upPlayer&&this.upPlayer.stop(),this.isGrasped?(_.eventCenter.trigger("gb_widget_countdown:pause"),s.play({token:this.token,actId:this.actId},$.proxy(function(e){if(this.isWinner="unknow",!e)return void this.checkWinner();var t=e.data;switch(this.gift={},e.code){case"000":case"001":break;case"111":case"112":if(this.isWinner="limit",t.limit){var i=0;isNaN(t.limit.share_dateMax)||isNaN(t.limit.share_date)||(i=t.limit.share_dateMax-t.limit.share_date,new a(i>0?{content:"请分享后刷新页面再试",duration:5e3}:{content:"今日次数已经用完，请明日再来！",duration:5e3}))}break;case"399":this.isWinner=!1;break;case"300":t&&t.sysGift&&1===t.sysGift.giftType?this.isWinner="unknow":t&&t.sysGift&&2===t.sysGift.giftType?t.sysGift.giftValue&&t.sysGift.giftName?(this.gift.value=t.sysGift.giftValue,this.gift.name=t.sysGift.giftName,this.gift.url=t.sysGift.coupon,this.isWinner=!0):new a("网络错误，请刷新重试"):this.isWinner=!1}this.checkWinner()},this))):(this.$pageHand.addClass("stop").removeClass("down"),this.$pageBtn6.show(),this.$pageHand.addClass("page_handlose"),this.$pageCraned.removeClass("down").removeClass("in"),this.lotteryDialog.lose(!0,$.proxy(function(){this.$pageHand.removeClass("stop"),this.$pageBtn1.show(),this.$pageBtn2.hide(),this.$pageBtn6.hide(),this.$pageHand.removeClass("page_handlose"),this.conf.$el.removeClass("in").addClass("in"),setTimeout($.proxy(function(){this.$countdown2.show(),_.eventCenter.trigger("gb_widget_countdown:reset"),_.eventCenter.trigger("gb_widget_countdown2:reset"),_.eventCenter.trigger("gb_widget_countdown2:start")},this),500)},this)))},checkWinner:function(){if(void 0!==this.isWinner){if("limit"===this.isWinner)return;if("unknow"===this.isWinner)return console.log("unknow"),void new a({content:"网络错误，请重新再试！"});if(this.isWinner){var e=this.gift;this.lotteryDialog.win(e.value,e.name,e.tip,e.url),this.player.setSrc("/xgames/games/images/get_gift_cba184d0.mp3","audio/mpeg"),this.player.play()}else this.lotteryDialog.lose()}else new a({content:"网络错误，请重新再试！"})}});i.exports=r});