"use strict";PP.define("games/page/slot_machine",function(t,e,n){var i=t("gb/widget/login"),s=t("gb/widget/lottery"),a=t("toast"),r=_.Class.extend({construct:function(t){this.conf=$.extend({$el:null},t),this.init()},init:function(){var t=this.conf.$el,e=document.documentElement,n=e.clientWidth,i=n>640?640:n,s=e.clientHeight;t.width(i),t.height(s),this.listenEvent(),this.token=null,this.checkValidate(!1)},listenEvent:function(){_.eventCenter.on("games_slot:init",$.proxy(this.onAfterCheck,this))},checkValidate:function(t){s.init({actId:this.conf.actId},$.proxy(function(e){if(e&&void 0!==e.code){var n=e.data;switch(e.code){case"000":case"001":_.eventCenter.trigger("games_slot:init",0,0,t),setTimeout(function(){new a("活动已经结束!",5e3)},800);break;case"111":case"112":var s=0;e.data.limit&&(isNaN(e.data.limit.share_dateMax)||isNaN(e.data.limit.share_date)||(s=e.data.limit.share_dateMax-e.data.limit.share_date,new a(s>0?"请分享后刷新页面再试":"今日次数已经用完，请明日再来！"))),_.eventCenter.trigger("games_slot:init",0,s,t);break;case"201":case"211":if(!n)return void new a("网络错误，请刷新重试");var r=parseInt(n.coin,10),o=!1;if(isNaN(r))return void new a("网络错误，请刷新重试");var l=Math.floor(r/this.conf.lotSingleCost),s=0;this.conf.$el.find(),o=l>0?!0:!1,!o&&n.limit&&(isNaN(n.limit.share_dateMax)||isNaN(n.limit.share_date)||(s=n.limit.share_dateMax-n.limit.share_date,new a(s>0?"分享增加次数":"今日次数已经用完，请明日再来！"))),this.token=e.token,_.eventCenter.trigger("games_slot:init",l,s,t);break;case"777":_.eventCenter.trigger("games_slot:init",0,0,t),setTimeout(function(){new a("请先登录!",5e3)},800),i.gotoLogin();break;default:_.eventCenter.trigger("games_slot:init",0,0,t),setTimeout(function(){new a("网络错误，请刷新重试!!",5e3)},800)}}else _.eventCenter.trigger("games_slot:init",0,0,t),setTimeout(function(){new a("网络错误，请刷新重试!!",5e3)},800)},this))},onAfterCheck:function(t,e,n){t>0&&setTimeout($.proxy(function(){_.eventCenter.trigger("games_slot:start",this.conf.actId,this.token)},this),2e3)}});n.exports=r}),PP.define("games/widget/tip",function(t,e,n){var i=_.Class.extend({construct:function(t){this.conf=$.extend({$el:null},t),this.init()},init:function(){this.listenEvent()},listenEvent:function(){_.eventCenter.on("games_slot:start",$.proxy(this.hide,this))},hide:function(){this.conf.$el.addClass("out")}});n.exports=i}),PP.define("games/widget/slot_machine",function(t,e,n){function i(t){var e=new Date,n=setInterval(function(){var i=new Date-e,s=i/t.duration;s>1&&(s=1);var a=t.delta(s);t.step(a),1==s&&clearInterval(n)},t.delay||10);return n}function s(t){return Math.pow(t,2)*(2.5*t-1.5)}function a(t){return function(e){return 1-t(1-e)}}function r(t){return Math.ceil(t/40*640/750*1e4)/1e4}var o=t("gb/widget/audio_player"),l=t("toast"),c=t("gb/widget/lottery"),h=t("gb/widget/lottery_dialog"),d={support3d:"WebKitCSSMatrix"in window&&"m11"in new WebKitCSSMatrix,setTranslateY:function(t){return this.support3d?"translate3d(0, "+t+", 0)":"translate(0, "+t+")"},setTranslateX:function(t){return this.support3d?"translate3d("+t+", 0, 0)":"translate("+t+", 0)"}},u=_.Class.extend({construct:function(t){this.conf=$.extend({$el:null},t),this.init()},init:function(){this.getElements(),this.listenEvent(),this.isPlayed=!1,this.lotteryDialog=new h,this.player=new o({autoplay:!1,loop:!1}),this.btnPlayer=new o({autoplay:!1,loop:!1})},getElements:function(){var t=this.conf.$el;this.$trackWrapperLeft=t.find(".slot_machine_left .slot_machine_track_wrapper"),this.$trackWrapperMiddle=t.find(".slot_machine_middle .slot_machine_track_wrapper"),this.$trackWrapperRight=t.find(".slot_machine_right .slot_machine_track_wrapper"),t.find(".slot_machine_main").addClass("hide")},initEvent:function(){var t=this;this.conf.$el.on("click",".slot_machine_go .page_btn1",function(){t.btnPlayer.setSrc("/xgames/games/images/crane_press_btn_88008cba.mp3"),t.btnPlayer.play();var e=$(this);$(".slot_machine_go .page_btn3").show(),_.eventCenter.trigger("gb_widget_countdown:start"),e.hide(),setTimeout(function(){$(".slot_machine_go .page_btn3").hide(),$(".slot_machine_go .page_btn2").show(),$(".slot_machine_stop .page_btn1").show(),$(".slot_machine_stop .page_btn2").hide(),t.scroll()},200)}).on("click",".slot_machine_stop .page_btn1",$.proxy(this.stop,this))},listenEvent:function(){var t=this;_.eventCenter.on("slot_machine:stop",function(e,n,i){setTimeout(function(){clearInterval(t.leftInterval),t.scrollLeftTrack(1,e,1500,a(s),!1),setTimeout(function(){clearInterval(t.middleInterval),t.scrollMiddleTrack(1,n,1500,a(s),!1),setTimeout(function(){clearInterval(t.rightInterval),t.scrollRightTrack(1,i,1500,a(s),!1,function(){if("limit"===t.isWinner)return $(".slot_machine_go .page_btn6").show(),$(".slot_machine_stop .page_btn6").show(),void _.eventCenter.trigger("gb_widget_countdown:stop");if(t.isWinner===!0){$(".slot_machine_go .page_btn5").show(),$(".slot_machine_stop .page_btn5").show();var e=t.gift;t.lotteryDialog.win(e.value,e.name,e.tip,e.url),t.player.setSrc("/xgames/games/images/get_gift_cba184d0.mp3","audio/mpeg"),t.player.play()}else $(".slot_machine_go .page_btn6").show(),$(".slot_machine_stop .page_btn6").show(),_.eventCenter.trigger("gb_widget_countdown:stop"),t.lotteryDialog.lose(!0,function(){t.isPlayed=!1,t.conf.$el.find(".countdown2").show(),t.conf.$el.find(".slot_machine_main").addClass("hide"),t.conf.$el.off("click"),$($(".slot_machine_go .page_btn").hide().get(0)).show(),$($(".slot_machine_stop .page_btn").hide().get(1)).show(),_.eventCenter.trigger("gb_widget_countdown:reset"),_.eventCenter.trigger("gb_widget_countdown2:reset"),setTimeout(function(){_.eventCenter.trigger("gb_widget_countdown2:start")},600)})})},1500)},1500)},1500)}),_.eventCenter.on("gb_widget_countdown2:timeisup",function(){setTimeout(function(){t.conf.$el.find(".slot_machine_main").removeClass("hide"),t.conf.$el.find(".countdown2").hide(),t.initEvent()},1e3)}),_.eventCenter.on("games_slot:start",$.proxy(this.show,this)),_.eventCenter.on("gb_widget_countdown:timeisup",$.proxy(this.stop,this))},checkGift:function(t){c.play({token:this.token,actId:this.actId},$.proxy(function(e){if(this.isWinner="unknow",!e)return void(t&&t());var n=e.data;switch(this.gift={},e.code){case"000":case"001":break;case"111":case"112":if(this.isWinner="limit",n.limit){var i=0;isNaN(n.limit.share_dateMax)||isNaN(n.limit.share_date)||(i=n.limit.share_dateMax-n.limit.share_date,new l(i>0?{content:"请分享后刷新页面再试",duration:5e3}:{content:"今日次数已经用完，请明日再来！",duration:5e3}))}break;case"399":this.isWinner=!1;break;case"300":n&&n.sysGift&&1===n.sysGift.giftType?this.isWinner="unknow":n&&n.sysGift&&2===n.sysGift.giftType?n.sysGift.giftValue&&n.sysGift.giftName?(this.gift.value=n.sysGift.giftValue,this.gift.name=n.sysGift.giftName,this.gift.url=n.sysGift.coupon,this.isWinner=!0):new l("网络错误，请刷新重试"):this.isWinner=!1}t&&t()},this))},show:function(t,e){this.actId=t,this.token=e,this.conf.$el.show().addClass("fadeIn"),setTimeout(function(){_.eventCenter.trigger("gb_widget_countdown2:start")},500)},scroll:function(){this.scrollLeftTrack(0,-1020,1500,function(t){return t},!0),setTimeout($.proxy(function(){this.scrollMiddleTrack(0,1020,1500,function(t){return t},!0),setTimeout($.proxy(function(){this.scrollRightTrack(0,-1020,1500,function(t){return t},!0)},this),1e3)},this),1e3)},stop:function(){this.isPlayed||(this.isPlayed=!0,this.btnPlayer.setSrc("/xgames/games/images/crane_press_btn_88008cba.mp3"),this.btnPlayer.play(),_.eventCenter.trigger("gb_widget_countdown:pause"),$(".slot_machine_stop .page_btn1").hide(),$(".slot_machine_stop .page_btn3").show(),setTimeout(function(){$(".slot_machine_stop .page_btn3").hide(),$(".slot_machine_stop .page_btn2").show()},200),this.checkGift($.proxy(function(){var t=Math.floor(5*Math.random()+1),e=Math.floor(6*Math.random()+1),n=Math.floor(6*Math.random()+1);return"unknow"===this.isWinner?(new l({content:"网络错误，请重新再试！"}),void _.eventCenter.trigger("slot_machine:stop",-170,170,-170)):"limit"===this.isWinner?void _.eventCenter.trigger("slot_machine:stop",-340,340,-340):(this.isWinner&&(t=6,e=2,n=4),void _.eventCenter.trigger("slot_machine:stop",170*-t,170*n,170*-e))},this)))},scrollLeftTrack:function(t,e,n,a,o,l){t++,this.leftInterval=i({delay:10,duration:n,delta:function(){return 1===t?s:a}(),step:$.proxy(function(n){return this.$trackWrapperLeft.css({"-webkit-transform":d.setTranslateY(r(e*n)+"rem"),transform:d.setTranslateY(r(e*n)+"rem")}),1===n&&o?(this.$trackWrapperLeft.css({"-webkit-transform":d.setTranslateY(0),transform:d.setTranslateY(0)}),this.scrollLeftTrack(t,e,400,a,o)):void(!o&&l&&1===n&&setTimeout(l,600))},this)})},scrollMiddleTrack:function(t,e,n,a,o,l){t++,this.middleInterval=i({delay:10,duration:n,delta:function(){return 1===t?s:a}(),step:$.proxy(function(n){return this.$trackWrapperMiddle.css({"-webkit-transform":d.setTranslateY(r(e*n)+"rem"),transform:d.setTranslateY(r(e*n)+"rem")}),1===n&&o?(this.$trackWrapperMiddle.css({"-webkit-transform":d.setTranslateY(0),transform:d.setTranslateY(0)}),this.scrollMiddleTrack(t,e,400,a,o)):void(!o&&l&&1===n&&setTimeout(l,600))},this)})},scrollRightTrack:function(t,e,n,a,o,l){t++,this.rightInterval=i({delay:10,duration:n,delta:function(){return 1===t?s:a}(),step:$.proxy(function(n){return this.$trackWrapperRight.css({"-webkit-transform":d.setTranslateY(r(e*n)+"rem"),transform:d.setTranslateY(r(e*n)+"rem")}),1===n&&o?(this.$trackWrapperRight.css({"-webkit-transform":d.setTranslateY(0),transform:d.setTranslateY(0)}),this.scrollRightTrack(t,e,400,a,o)):void(!o&&l&&1===n&&setTimeout(l,600))},this)})}});n.exports=u});